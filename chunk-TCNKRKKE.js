import{$c as ri,Cb as ae,Eb as at,Fb as U,Gb as Et,I as Xe,Jb as st,Kb as ei,L as F,M as re,Mc as jt,N as ti,Nc as P,O as M,Oc as k,P as At,Pc as bt,Tc as pt,Vc as y,Wc as Ot,bd as _e,cd as Ae,e as ie,g as n,h as a,j as Ke,k as Qe,m as Se,n as A,u as L,va as oe,xb as ne}from"./chunk-YKS7C5EI.js";import{a as we,d as j,e as Vt,f as T,g as ii}from"./chunk-7LJ4HG3M.js";var G=j((Bt,Ee)=>{"use strict";Object.defineProperty(Bt,"__esModule",{value:!0});Bt.default=Wi;function Wi(t){if(t==null)throw new TypeError("Expected a string but received a ".concat(t));if(t.constructor.name!=="String")throw new TypeError("Expected a string but received a ".concat(t.constructor.name))}Ee.exports=Bt.default;Ee.exports.default=Bt.default});var Lt=j((Ct,be)=>{"use strict";Object.defineProperty(Ct,"__esModule",{value:!0});Ct.default=Zi;function Zi(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;for(var i in e)typeof t[i]>"u"&&(t[i]=e[i]);return t}be.exports=Ct.default;be.exports.default=Ct.default});var Fe=j((qt,Oe)=>{"use strict";Object.defineProperty(qt,"__esModule",{value:!0});qt.default=er;var Yi=pi(G()),Gi=pi(Lt());function pi(t){return t&&t.__esModule?t:{default:t}}var Ki=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{4})$/,Qi=/^[A-Za-z0-9+/]+$/,Xi=/^(?:[A-Za-z0-9_-]{4})*(?:[A-Za-z0-9_-]{2}==|[A-Za-z0-9_-]{3}=|[A-Za-z0-9_-]{4})$/,tr=/^[A-Za-z0-9_-]+$/;function er(t,e){var i;if((0,Yi.default)(t),e=(0,Gi.default)(e,{urlSafe:!1,padding:!((i=e)!==null&&i!==void 0&&i.urlSafe)}),t==="")return!0;var r;return e.urlSafe?r=e.padding?Xi:tr:r=e.padding?Ki:Qi,(!e.padding||t.length%4===0)&&r.test(t)}Oe.exports=qt.default;Oe.exports.default=qt.default});var li=j((zt,Te)=>{"use strict";Object.defineProperty(zt,"__esModule",{value:!0});zt.default=ar;var or=nr(G());function nr(t){return t&&t.__esModule?t:{default:t}}function Me(t){"@babel/helpers - typeof";return Me=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Me(t)}function ar(t,e){(0,or.default)(t);var i,r;Me(e)==="object"?(i=e.min||0,r=e.max):(i=arguments[1],r=arguments[2]);var o=encodeURI(t).split(/%..|./).length-1;return o>=i&&(typeof r>"u"||o<=r)}Te.exports=zt.default;Te.exports.default=zt.default});var ui=j((Ht,Ne)=>{"use strict";Object.defineProperty(Ht,"__esModule",{value:!0});Ht.default=pr;function sr(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function pr(t,e){for(var i=0;i<e.length;i++){var r=e[i];if(t===r||sr(r)&&r.test(t))return!0}return!1}Ne.exports=Ht.default;Ne.exports.default=Ht.default});var mi=j((Jt,$e)=>{"use strict";Object.defineProperty(Jt,"__esModule",{value:!0});Jt.default=ur;var cr=fi(G()),dr=fi(Lt());function fi(t){return t&&t.__esModule?t:{default:t}}var lr={require_tld:!0,allow_underscores:!1,allow_trailing_dot:!1,allow_numeric_tld:!1,allow_wildcard:!1,ignore_max_length:!1};function ur(t,e){(0,cr.default)(t),e=(0,dr.default)(e,lr),e.allow_trailing_dot&&t[t.length-1]==="."&&(t=t.substring(0,t.length-1)),e.allow_wildcard===!0&&t.indexOf("*.")===0&&(t=t.substring(2));var i=t.split("."),r=i[i.length-1];return e.require_tld&&(i.length<2||!e.allow_numeric_tld&&!/^([a-z\u00A1-\u00A8\u00AA-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]{2,}|xn[a-z0-9-]{2,})$/i.test(r)||/\s/.test(r))||!e.allow_numeric_tld&&/^\d+$/.test(r)?!1:i.every(function(o){return!(o.length>63&&!e.ignore_max_length||!/^[a-z_\u00a1-\uffff0-9-]+$/i.test(o)||/[\uff01-\uff5e]/.test(o)||/^-|-$/.test(o)||!e.allow_underscores&&/_/.test(o))})}$e.exports=Jt.default;$e.exports.default=Jt.default});var yi=j((Wt,je)=>{"use strict";Object.defineProperty(Wt,"__esModule",{value:!0});Wt.default=Ve;var fr=mr(G());function mr(t){return t&&t.__esModule?t:{default:t}}function De(t){"@babel/helpers - typeof";return De=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},De(t)}var gi="(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])",ct="(".concat(gi,"[.]){3}").concat(gi),gr=new RegExp("^".concat(ct,"$")),O="(?:[0-9a-fA-F]{1,4})",yr=new RegExp("^("+"(?:".concat(O,":){7}(?:").concat(O,"|:)|")+"(?:".concat(O,":){6}(?:").concat(ct,"|:").concat(O,"|:)|")+"(?:".concat(O,":){5}(?::").concat(ct,"|(:").concat(O,"){1,2}|:)|")+"(?:".concat(O,":){4}(?:(:").concat(O,"){0,1}:").concat(ct,"|(:").concat(O,"){1,3}|:)|")+"(?:".concat(O,":){3}(?:(:").concat(O,"){0,2}:").concat(ct,"|(:").concat(O,"){1,4}|:)|")+"(?:".concat(O,":){2}(?:(:").concat(O,"){0,3}:").concat(ct,"|(:").concat(O,"){1,5}|:)|")+"(?:".concat(O,":){1}(?:(:").concat(O,"){0,4}:").concat(ct,"|(:").concat(O,"){1,6}|:)|")+"(?::((?::".concat(O,"){0,5}:").concat(ct,"|(?::").concat(O,"){1,7}|:))")+")(%[0-9a-zA-Z.]{1,})?$");function Ve(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,fr.default)(t);var i=(De(e)==="object"?e.version:arguments[1])||"";return i?i.toString()==="4"?gr.test(t):i.toString()==="6"?yr.test(t):!1:Ve(t,{version:4})||Ve(t,{version:6})}je.exports=Wt.default;je.exports.default=Wt.default});var xi=j((Zt,Pe)=>{"use strict";Object.defineProperty(Zt,"__esModule",{value:!0});Zt.default=Mr;var hr=Ft(G()),hi=Ft(ui()),Ue=Ft(li()),vr=Ft(mi()),vi=Ft(yi()),xr=Ft(Lt());function Ft(t){return t&&t.__esModule?t:{default:t}}var Ir={allow_display_name:!1,allow_underscores:!1,require_display_name:!1,allow_utf8_local_part:!0,require_tld:!0,blacklisted_chars:"",ignore_max_length:!1,host_blacklist:[],host_whitelist:[]},wr=/^([^\x00-\x1F\x7F-\x9F\cX]+)</i,Sr=/^[a-z\d!#\$%&'\*\+\-\/=\?\^_`{\|}~]+$/i,_r=/^[a-z\d]+$/,Ar=/^([\s\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e]|(\\[\x01-\x09\x0b\x0c\x0d-\x7f]))*$/i,Er=/^[a-z\d!#\$%&'\*\+\-\/=\?\^_`{\|}~\u00A1-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+$/i,br=/^([\s\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|(\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*$/i,Or=254;function Fr(t){var e=t.replace(/^"(.+)"$/,"$1");if(!e.trim())return!1;var i=/[\.";<>]/.test(e);if(i){if(e===t)return!1;var r=e.split('"').length===e.split('\\"').length;if(!r)return!1}return!0}function Mr(t,e){if((0,hr.default)(t),e=(0,xr.default)(e,Ir),e.require_display_name||e.allow_display_name){var i=t.match(wr);if(i){var r=i[1];if(t=t.replace(r,"").replace(/(^<|>$)/g,""),r.endsWith(" ")&&(r=r.slice(0,-1)),!Fr(r))return!1}else if(e.require_display_name)return!1}if(!e.ignore_max_length&&t.length>Or)return!1;var o=t.split("@"),s=o.pop(),d=s.toLowerCase();if(e.host_blacklist.length>0&&(0,hi.default)(d,e.host_blacklist)||e.host_whitelist.length>0&&!(0,hi.default)(d,e.host_whitelist))return!1;var l=o.join("@");if(e.domain_specific_validation&&(d==="gmail.com"||d==="googlemail.com")){l=l.toLowerCase();var _=l.split("+")[0];if(!(0,Ue.default)(_.replace(/\./g,""),{min:6,max:30}))return!1;for(var w=_.split("."),b=0;b<w.length;b++)if(!_r.test(w[b]))return!1}if(e.ignore_max_length===!1&&(!(0,Ue.default)(l,{max:64})||!(0,Ue.default)(s,{max:254})))return!1;if(!(0,vr.default)(s,{require_tld:e.require_tld,ignore_max_length:e.ignore_max_length,allow_underscores:e.allow_underscores})){if(!e.allow_ip_domain)return!1;if(!(0,vi.default)(s)){if(!s.startsWith("[")||!s.endsWith("]"))return!1;var J=s.slice(1,-1);if(J.length===0||!(0,vi.default)(J))return!1}}if(e.blacklisted_chars&&l.search(new RegExp("[".concat(e.blacklisted_chars,"]+"),"g"))!==-1)return!1;if(l[0]==='"'&&l[l.length-1]==='"')return l=l.slice(1,l.length-1),e.allow_utf8_local_part?br.test(l):Ar.test(l);for(var f=e.allow_utf8_local_part?Er:Sr,u=l.split("."),S=0;S<u.length;S++)if(!f.test(u[S]))return!1;return!0}Pe.exports=Zt.default;Pe.exports.default=Zt.default});var wi=j((Mt,ke)=>{"use strict";Object.defineProperty(Mt,"__esModule",{value:!0});Mt.default=void 0;var $r=function(e,i){return e.some(function(r){return i===r})},Pn=Mt.default=$r;ke.exports=Mt.default;ke.exports.default=Mt.default});var Si=j((Yt,Ce)=>{"use strict";Object.defineProperty(Yt,"__esModule",{value:!0});Yt.default=Pr;var Dr=Be(G()),Vr=Be(wi()),jr=Be(Lt());function Be(t){return t&&t.__esModule?t:{default:t}}function Re(t){"@babel/helpers - typeof";return Re=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Re(t)}var Ur={allow_primitives:!1};function Pr(t,e){(0,Dr.default)(t);try{e=(0,jr.default)(e,Ur);var i=[];e.allow_primitives&&(i=[null,!1,!0]);var r=JSON.parse(t);return(0,Vr.default)(i,r)||!!r&&Re(r)==="object"}catch{}return!1}Ce.exports=Yt.default;Ce.exports.default=Yt.default});var Ei=j((Gt,Le)=>{"use strict";Object.defineProperty(Gt,"__esModule",{value:!0});Gt.default=Lr;var Br=Ai(G()),Cr=Ai(Fe());function Ai(t){return t&&t.__esModule?t:{default:t}}function Lr(t){(0,Br.default)(t);var e=t.split("."),i=e.length;return i!==3?!1:e.reduce(function(r,o){return r&&(0,Cr.default)(o,{urlSafe:!0})},!0)}Le.exports=Gt.default;Le.exports.default=Gt.default});var Fi=j((Kt,qe)=>{"use strict";Object.defineProperty(Kt,"__esModule",{value:!0});Kt.default=Wr;var Hr=Jr(G());function Jr(t){return t&&t.__esModule?t:{default:t}}var Oi={1:/^[0-9A-F]{8}-[0-9A-F]{4}-1[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,2:/^[0-9A-F]{8}-[0-9A-F]{4}-2[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,3:/^[0-9A-F]{8}-[0-9A-F]{4}-3[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,4:/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,5:/^[0-9A-F]{8}-[0-9A-F]{4}-5[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,6:/^[0-9A-F]{8}-[0-9A-F]{4}-6[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,7:/^[0-9A-F]{8}-[0-9A-F]{4}-7[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,8:/^[0-9A-F]{8}-[0-9A-F]{4}-8[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,nil:/^00000000-0000-0000-0000-000000000000$/i,max:/^ffffffff-ffff-ffff-ffff-ffffffffffff$/i,loose:/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i,all:/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i};function Wr(t,e){return(0,Hr.default)(t),e==null&&(e="all"),e in Oi?Oi[e].test(t):!1}qe.exports=Kt.default;qe.exports.default=Kt.default});var vt=class{get(e){return T(this,null,function*(){return yield localStorage.getItem(e)})}set(e,i){return T(this,null,function*(){localStorage.setItem(e,i)})}remove(e){return T(this,null,function*(){localStorage.removeItem(e)})}};var I=class extends jt{};var q=class extends jt{};var N=class{id;remoteAccessToken;data;constructor(e,i,r){this.id=e,this.remoteAccessToken=i,this.data=r}getId(){return this.id}getToken(){return this.remoteAccessToken}getData(){return this.data}};var R=class{constructor(e){this.groups=[],this.each=!1,this.context=void 0,this.type=e.type,this.name=e.name,this.target=e.target,this.propertyName=e.propertyName,this.constraints=e?.constraints,this.constraintCls=e.constraintCls,this.validationTypeOptions=e.validationTypeOptions,e.validationOptions&&(this.message=e.validationOptions.message,this.groups=e.validationOptions.groups,this.always=e.validationOptions.always,this.each=e.validationOptions.each,this.context=e.validationOptions.context)}};var se=class{transform(e){let i=[];return Object.keys(e.properties).forEach(r=>{e.properties[r].forEach(o=>{let s={message:o.message,groups:o.groups,always:o.always,each:o.each},d={type:o.type,name:o.name,target:e.name,propertyName:r,constraints:o.constraints,validationTypeOptions:o.options,validationOptions:s};i.push(new R(d))})}),i}};function oi(t){return t instanceof Map?Array.from(t.values()):Array.isArray(t)?t:Array.from(t)}function ni(){if(typeof globalThis<"u")return globalThis;if(typeof global<"u")return global;if(typeof window<"u")return window;if(typeof self<"u")return self}function pe(t){return t!==null&&typeof t=="object"&&typeof t.then=="function"}var Ut=class{constructor(){this.validationMetadatas=new Map,this.constraintMetadatas=new Map}get hasValidationMetaData(){return!!this.validationMetadatas.size}addValidationSchema(e){new se().transform(e).forEach(r=>this.addValidationMetadata(r))}addValidationMetadata(e){let i=this.validationMetadatas.get(e.target);i?i.push(e):this.validationMetadatas.set(e.target,[e])}addConstraintMetadata(e){let i=this.constraintMetadatas.get(e.target);i?i.push(e):this.constraintMetadatas.set(e.target,[e])}groupByPropertyName(e){let i={};return e.forEach(r=>{i[r.propertyName]||(i[r.propertyName]=[]),i[r.propertyName].push(r)}),i}getTargetValidationMetadatas(e,i,r,o,s){let d=u=>typeof u.always<"u"?u.always:u.groups&&u.groups.length?!1:r,l=u=>!!(o&&(!s||!s.length)&&u.groups&&u.groups.length),w=(this.validationMetadatas.get(e)||[]).filter(u=>u.target!==e&&u.target!==i?!1:d(u)?!0:l(u)?!1:s&&s.length>0?u.groups&&!!u.groups.find(S=>s.indexOf(S)!==-1):!0),b=[];for(let[u,S]of this.validationMetadatas.entries())e.prototype instanceof u&&b.push(...S);let f=b.filter(u=>typeof u.target=="string"||u.target===e||u.target instanceof Function&&!(e.prototype instanceof u.target)?!1:d(u)?!0:l(u)?!1:s&&s.length>0?u.groups&&!!u.groups.find(S=>s.indexOf(S)!==-1):!0).filter(u=>!w.find(S=>S.propertyName===u.propertyName&&S.type===u.type));return w.concat(f)}getTargetValidatorConstraints(e){return this.constraintMetadatas.get(e)||[]}};function z(){let t=ni();return t.classValidatorMetadataStorage||(t.classValidatorMetadataStorage=new Ut),t.classValidatorMetadataStorage}var Pt=class{toString(e=!1,i=!1,r="",o=!1){let s=e?"\x1B[1m":"",d=e?"\x1B[22m":"",l=()=>{var w;return(o?Object.values:Object.keys)((w=this.constraints)!==null&&w!==void 0?w:{}).join(", ")},_=w=>` - property ${s}${r}${w}${d} has failed the following constraints: ${s}${l()}${d} 
`;if(i){let w=Number.isInteger(+this.property)?`[${this.property}]`:`${r?".":""}${this.property}`;return this.constraints?_(w):this.children?this.children.map(b=>b.toString(e,!0,`${r}${w}`,o)).join(""):""}else return`An instance of ${s}${this.target?this.target.constructor.name:"an object"}${d} has failed the validation:
`+(this.constraints?_(this.property):"")+(this.children?this.children.map(w=>w.toString(e,!0,this.property,o)).join(""):"")}};var E=(()=>{class t{static isValid(i){return i!=="isValid"&&i!=="getMessage"&&Object.keys(this).map(r=>this[r]).indexOf(i)!==-1}}return t.CUSTOM_VALIDATION="customValidation",t.NESTED_VALIDATION="nestedValidation",t.PROMISE_VALIDATION="promiseValidation",t.CONDITIONAL_VALIDATION="conditionalValidation",t.WHITELIST="whitelistValidation",t.IS_DEFINED="isDefined",t})();function Bi(t){return Array.isArray(t)?t.join(", "):(typeof t=="symbol"&&(t=t.description),`${t}`)}var ce=class{static replaceMessageSpecialTokens(e,i){let r;return e instanceof Function?r=e(i):typeof e=="string"&&(r=e),r&&Array.isArray(i.constraints)&&i.constraints.forEach((o,s)=>{r=r.replace(new RegExp(`\\$constraint${s+1}`,"g"),Bi(o))}),r&&i.value!==void 0&&i.value!==null&&["string","boolean","number"].includes(typeof i.value)&&(r=r.replace(/\$value/g,i.value)),r&&(r=r.replace(/\$property/g,i.property)),r&&(r=r.replace(/\$target/g,i.targetName)),r}};var kt=class{constructor(e,i){this.validator=e,this.validatorOptions=i,this.awaitingPromises=[],this.ignoreAsyncValidations=!1,this.metadataStorage=z()}execute(e,i,r){var o,s;!this.metadataStorage.hasValidationMetaData&&((o=this.validatorOptions)===null||o===void 0?void 0:o.enableDebugMessages)===!0&&console.warn(`No validation metadata found. No validation will be  performed. There are multiple possible reasons:
  - There may be multiple class-validator versions installed. You will need to flatten your dependencies to fix the issue.
  - This validation runs before any file with validation decorator was parsed by NodeJS.`);let d=this.validatorOptions?this.validatorOptions.groups:void 0,l=this.validatorOptions&&this.validatorOptions.strictGroups||!1,_=this.validatorOptions&&this.validatorOptions.always||!1,w=((s=this.validatorOptions)===null||s===void 0?void 0:s.forbidUnknownValues)===void 0||this.validatorOptions.forbidUnknownValues!==!1,b=this.metadataStorage.getTargetValidationMetadatas(e.constructor,i,_,l,d),J=this.metadataStorage.groupByPropertyName(b);if(w&&!b.length){let f=new Pt;(!this.validatorOptions||!this.validatorOptions.validationError||this.validatorOptions.validationError.target===void 0||this.validatorOptions.validationError.target===!0)&&(f.target=e),f.value=void 0,f.property=void 0,f.children=[],f.constraints={unknownValue:"an unknown value was passed to the validate function"},r.push(f);return}this.validatorOptions&&this.validatorOptions.whitelist&&this.whitelist(e,J,r),Object.keys(J).forEach(f=>{let u=e[f],S=J[f].filter(D=>D.type===E.IS_DEFINED),nt=J[f].filter(D=>D.type!==E.IS_DEFINED&&D.type!==E.WHITELIST);u instanceof Promise&&nt.find(D=>D.type===E.PROMISE_VALIDATION)?this.awaitingPromises.push(u.then(D=>{this.performValidations(e,D,f,S,nt,r)})):this.performValidations(e,u,f,S,nt,r)})}whitelist(e,i,r){let o=[];Object.keys(e).forEach(s=>{(!i[s]||i[s].length===0)&&o.push(s)}),o.length>0&&(this.validatorOptions&&this.validatorOptions.forbidNonWhitelisted?o.forEach(s=>{let d=this.generateValidationError(e,e[s],s);d.constraints={[E.WHITELIST]:`property ${s} should not exist`},d.children=void 0,r.push(d)}):o.forEach(s=>delete e[s]))}stripEmptyErrors(e){return e.filter(i=>{if(i.children&&(i.children=this.stripEmptyErrors(i.children)),Object.keys(i.constraints).length===0){if(i.children.length===0)return!1;delete i.constraints}return!0})}performValidations(e,i,r,o,s,d){let l=s.filter(f=>f.type===E.CUSTOM_VALIDATION),_=s.filter(f=>f.type===E.NESTED_VALIDATION),w=s.filter(f=>f.type===E.CONDITIONAL_VALIDATION),b=this.generateValidationError(e,i,r);d.push(b),this.conditionalValidations(e,i,w)&&(this.customValidations(e,i,o,b),this.mapContexts(e,i,o,b),!(i===void 0&&this.validatorOptions&&this.validatorOptions.skipUndefinedProperties===!0)&&(i===null&&this.validatorOptions&&this.validatorOptions.skipNullProperties===!0||i==null&&this.validatorOptions&&this.validatorOptions.skipMissingProperties===!0||(this.customValidations(e,i,l,b),this.nestedValidations(i,_,b),this.mapContexts(e,i,s,b),this.mapContexts(e,i,l,b))))}generateValidationError(e,i,r){let o=new Pt;return(!this.validatorOptions||!this.validatorOptions.validationError||this.validatorOptions.validationError.target===void 0||this.validatorOptions.validationError.target===!0)&&(o.target=e),(!this.validatorOptions||!this.validatorOptions.validationError||this.validatorOptions.validationError.value===void 0||this.validatorOptions.validationError.value===!0)&&(o.value=i),o.property=r,o.children=[],o.constraints={},o}conditionalValidations(e,i,r){return r.map(o=>o.constraints[0](e,i)).reduce((o,s)=>o&&s,!0)}customValidations(e,i,r,o){r.forEach(s=>{this.metadataStorage.getTargetValidatorConstraints(s.constraintCls).forEach(d=>{if(d.async&&this.ignoreAsyncValidations||this.validatorOptions&&this.validatorOptions.stopAtFirstError&&Object.keys(o.constraints||{}).length>0)return;let l={targetName:e.constructor?e.constructor.name:void 0,property:s.propertyName,object:e,value:i,constraints:s.constraints};if(!s.each||!(Array.isArray(i)||i instanceof Set||i instanceof Map)){let f=d.instance.validate(i,l);if(pe(f)){let u=f.then(S=>{if(!S){let[nt,D]=this.createValidationError(e,i,s,d);o.constraints[nt]=D,s.context&&(o.contexts||(o.contexts={}),o.contexts[nt]=Object.assign(o.contexts[nt]||{},s.context))}});this.awaitingPromises.push(u)}else if(!f){let[u,S]=this.createValidationError(e,i,s,d);o.constraints[u]=S}return}let w=oi(i).map(f=>d.instance.validate(f,l));if(w.some(f=>pe(f))){let f=w.map(S=>pe(S)?S:Promise.resolve(S)),u=Promise.all(f).then(S=>{if(!S.every(D=>D)){let[D,Ri]=this.createValidationError(e,i,s,d);o.constraints[D]=Ri,s.context&&(o.contexts||(o.contexts={}),o.contexts[D]=Object.assign(o.contexts[D]||{},s.context))}});this.awaitingPromises.push(u);return}if(!w.every(f=>f)){let[f,u]=this.createValidationError(e,i,s,d);o.constraints[f]=u}})})}nestedValidations(e,i,r){e!==void 0&&i.forEach(o=>{if(!(o.type!==E.NESTED_VALIDATION&&o.type!==E.PROMISE_VALIDATION)&&!(this.validatorOptions&&this.validatorOptions.stopAtFirstError&&Object.keys(r.constraints||{}).length>0))if(Array.isArray(e)||e instanceof Set||e instanceof Map)(e instanceof Set?Array.from(e):e).forEach((d,l)=>{this.performValidations(e,d,l.toString(),[],i,r.children)});else if(e instanceof Object){let s=typeof o.target=="string"?o.target:o.target.name;this.execute(e,s,r.children)}else{let[s,d]=this.createValidationError(o.target,e,o);r.constraints[s]=d}})}mapContexts(e,i,r,o){return r.forEach(s=>{if(s.context){let d;s.type===E.CUSTOM_VALIDATION&&(d=this.metadataStorage.getTargetValidatorConstraints(s.constraintCls)[0]);let l=this.getConstraintType(s,d);o.constraints[l]&&(o.contexts||(o.contexts={}),o.contexts[l]=Object.assign(o.contexts[l]||{},s.context))}})}createValidationError(e,i,r,o){let s=e.constructor?e.constructor.name:void 0,d=this.getConstraintType(r,o),l={targetName:s,property:r.propertyName,object:e,value:i,constraints:r.constraints},_=r.message||"";!r.message&&(!this.validatorOptions||this.validatorOptions&&!this.validatorOptions.dismissDefaultMessages)&&o&&o.instance.defaultMessage instanceof Function&&(_=o.instance.defaultMessage(l));let w=ce.replaceMessageSpecialTokens(_,l);return[d,w]}getConstraintType(e,i){return i&&i.name?i.name:e.type}};var Rt=class{validate(e,i,r){return this.coreValidate(e,i,r)}validateOrReject(e,i,r){return T(this,null,function*(){let o=yield this.coreValidate(e,i,r);if(o.length)return Promise.reject(o)})}validateSync(e,i,r){let o=typeof e=="string"?i:e,s=typeof e=="string"?r:i,d=typeof e=="string"?e:void 0,l=new kt(this,s);l.ignoreAsyncValidations=!0;let _=[];return l.execute(o,d,_),l.stripEmptyErrors(_)}coreValidate(e,i,r){let o=typeof e=="string"?i:e,s=typeof e=="string"?r:i,d=typeof e=="string"?e:void 0,l=new kt(this,s),_=[];return l.execute(o,d,_),Promise.all(l.awaitingPromises).then(()=>l.stripEmptyErrors(_))}};var Ci=new class{constructor(){this.instances=[]}get(t){let e=this.instances.find(i=>i.type===t);return e||(e={type:t,object:new t},this.instances.push(e)),e.object}},ai,de;function xt(t){if(ai)try{let e=ai.get(t);if(e||!de||!de.fallback)return e}catch(e){if(!de||!de.fallbackOnErrors)throw e}return Ci.get(t)}var le=class{constructor(e,i,r=!1){this.target=e,this.name=i,this.async=r}get instance(){return xt(this.target)}};function si(t){let e;if(t.validator instanceof Function){if(e=t.validator,xt(Ut).getTargetValidatorConstraints(t.validator).length>1)throw`More than one implementation of ValidatorConstraintInterface found for validator on: ${t.target.name}:${t.propertyName}`}else{let r=t.validator;e=class{validate(s,d){return r.validate(s,d)}defaultMessage(s){return r.defaultMessage?r.defaultMessage(s):""}},z().addConstraintMetadata(new le(e,t.name,t.async))}let i={type:t.name&&E.isValid(t.name)?t.name:E.CUSTOM_VALIDATION,name:t.name,target:t.target,propertyName:t.propertyName,validationOptions:t.options,constraintCls:e,constraints:t.constraints};z().addValidationMetadata(new R(i))}function h(t,e){return i=>{let r=e&&e.each?"each value in ":"";return t(r,i)}}function v(t,e){return function(i,r){si({name:t.name,target:i.constructor,propertyName:r,options:e,constraints:t.constraints,validator:t.validator})}}var Li="isOptional";function $(t){return function(e,i){let r={type:E.CONDITIONAL_VALIDATION,name:Li,target:e.constructor,propertyName:i,constraints:[(o,s)=>o[i]!==null&&o[i]!==void 0],validationOptions:t};z().addValidationMetadata(new R(r))}}function wn(t,e){return function(i,r){let o={type:E.CONDITIONAL_VALIDATION,target:i.constructor,propertyName:r,constraints:[t],validationOptions:e};z().addValidationMetadata(new R(o))}}function m(t){let e=we({},t),i=e.each?"each value in ":"";return e.message=e.message||i+"nested property $property must be either object or array",function(r,o){let s={type:E.NESTED_VALIDATION,target:r.constructor,propertyName:o,validationOptions:e};z().addValidationMetadata(new R(s))}}var qi="isNotEmpty";function zi(t){return t!==""&&t!==null&&t!==void 0}function p(t){return v({name:qi,validator:{validate:(e,i)=>zi(e),defaultMessage:h(e=>e+"$property should not be empty",t)}},t)}var Hi="isIn";function Ji(t,e){return Array.isArray(e)&&e.some(i=>i===t)}function Nn(t,e){return v({name:Hi,constraints:[t],validator:{validate:(i,r)=>Ji(i,r?.constraints[0]),defaultMessage:h(i=>i+"$property must be one of the following values: $constraint1",e)}},e)}var ci=Vt(Fe()),ir="isBase64";function rr(t,e){return typeof t=="string"&&(0,ci.default)(t,e)}function di(t,e){return v({name:ir,constraints:[t],validator:{validate:(i,r)=>rr(i,r?.constraints[0]),defaultMessage:h(i=>i+"$property must be base64 encoded",e)}},e)}var Ii=Vt(xi()),Tr="isEmail";function Nr(t,e){return typeof t=="string"&&(0,Ii.default)(t,e)}function K(t,e){return v({name:Tr,constraints:[t],validator:{validate:(i,r)=>Nr(i,r?.constraints[0]),defaultMessage:h(i=>i+"$property must be an email",e)}},e)}var _i=Vt(Si()),kr="isJson";function Rr(t){return typeof t=="string"&&(0,_i.default)(t)}function Rn(t){return v({name:kr,validator:{validate:(e,i)=>Rr(e),defaultMessage:h(e=>e+"$property must be a json string",t)}},t)}var bi=Vt(Ei()),qr="isJwt";function zr(t){return typeof t=="string"&&(0,bi.default)(t)}function dt(t){return v({name:qr,validator:{validate:(e,i)=>zr(e),defaultMessage:h(e=>e+"$property must be a jwt string",t)}},t)}var Mi=Vt(Fi()),Zr="isUuid";function Yr(t,e){return typeof t=="string"&&(0,Mi.default)(t,e)}function x(t,e){return v({name:Zr,constraints:[t],validator:{validate:(i,r)=>Yr(i,r?.constraints[0]),defaultMessage:h(i=>i+"$property must be a UUID",e)}},e)}var Gr="isBoolean";function Kr(t){return t instanceof Boolean||typeof t=="boolean"}function W(t){return v({name:Gr,validator:{validate:(e,i)=>Kr(e),defaultMessage:h(e=>e+"$property must be a boolean value",t)}},t)}var Qr="isDate";function Xr(t){return t instanceof Date&&!isNaN(t.getTime())}function Zn(t){return v({name:Qr,validator:{validate:(e,i)=>Xr(e),defaultMessage:h(e=>e+"$property must be a Date instance",t)}},t)}var to="isNumber";function eo(t,e={}){if(typeof t!="number")return!1;if(t===1/0||t===-1/0)return!!e.allowInfinity;if(Number.isNaN(t))return!!e.allowNaN;if(e.maxDecimalPlaces!==void 0){let i=0;if(t%1!==0&&(i=t.toString().split(".")[1].length),i>e.maxDecimalPlaces)return!1}return Number.isFinite(t)}function Ti(t={},e){return v({name:to,constraints:[t],validator:{validate:(i,r)=>eo(i,r?.constraints[0]),defaultMessage:h(i=>i+"$property must be a number conforming to the specified constraints",e)}},e)}var io="isEnum";function ro(t,e){return Object.keys(e).map(r=>e[r]).includes(t)}function oo(t){return Object.entries(t).filter(([e,i])=>isNaN(parseInt(e))).map(([e,i])=>i)}function Ni(t,e){return v({name:io,constraints:[t,oo(t)],validator:{validate:(i,r)=>ro(i,r?.constraints[0]),defaultMessage:h(i=>i+"$property must be one of the following values: $constraint2",e)}},e)}var no="isInt";function ao(t){return typeof t=="number"&&Number.isInteger(t)}function ue(t){return v({name:no,validator:{validate:(e,i)=>ao(e),defaultMessage:h(e=>e+"$property must be an integer number",t)}},t)}var so="isString";function po(t){return t instanceof String||typeof t=="string"}function c(t){return v({name:so,validator:{validate:(e,i)=>po(e),defaultMessage:h(e=>e+"$property must be a string",t)}},t)}var co="isArray";function lo(t){return Array.isArray(t)}function g(t){return v({name:co,validator:{validate:(e,i)=>lo(e),defaultMessage:h(e=>e+"$property must be an array",t)}},t)}var uo="isObject";function fo(t){return t!=null&&(typeof t=="object"||typeof t=="function")&&!Array.isArray(t)}function Tt(t){return v({name:uo,validator:{validate:(e,i)=>fo(e),defaultMessage:h(e=>e+"$property must be an object",t)}},t)}function $i(t,e,i){return typeof t=="string"?xt(Rt).validateOrReject(t,e,i):xt(Rt).validateOrReject(t,e)}var fe=class{wrapRequest(e,i){return i!=null&&e.pipe(L(r=>{throw r}),A(r=>this.adapt(r,i))),e}wrapVoidRequest(e,i){let r=new Set(i?.swallowStatuses??[]);return e.pipe(L(o=>{let s=o&&typeof o.status=="number"?o.status:void 0;return s!=null&&r.has(s)?Ke(void 0):Qe(()=>this.mapError(o))}))}mapError(e){return e}adapt(e,i){let r=Ot(i,e);return $i(r).catch(o=>{let s="";for(let d of o)s+=" | "+d.toString().trim().replace(/(\r\n|\n|\r)/gm,"");throw new Error("Response validation failed"+s+" with data "+JSON.stringify(e))}),r}};var me=class extends fe{constructor(){super()}wrapObjectRequest(e,i){let r=this.wrapHeimdallRequest(e);return i!=null?r.pipe(A(o=>this.adapt(o,i))):r}wrapHeimdallRequest(e){return super.wrapRequest(e)}};var Nt=class{message};n([p(),c(),a("design:type",String)],Nt.prototype,"message",void 0);var ze=class{error};n([p(),Tt(),m(),y(()=>Nt),a("design:type",Nt)],ze.prototype,"error",void 0);var Q=class{id;accessToken;name;scopes};n([p(),x(),a("design:type",String)],Q.prototype,"id",void 0);n([p(),dt(),pt({name:"access_token"}),a("design:type",String)],Q.prototype,"accessToken",void 0);n([p(),c(),a("design:type",String)],Q.prototype,"name",void 0);n([p(),Tt(),m(),a("design:type",Object)],Q.prototype,"scopes",void 0);var X=class extends Q{email;alias;emailChange;groups};n([p(),K(),a("design:type",String)],X.prototype,"email",void 0);n([$(),c(),a("design:type",Object)],X.prototype,"alias",void 0);n([$(),K(),pt({name:"email_change"}),a("design:type",Object)],X.prototype,"emailChange",void 0);n([p(),g(),c({each:!0}),a("design:type",Array)],X.prototype,"groups",void 0);var Qt=class extends X{};var tt=class{id;accessToken;name;email;alias};n([p(),x(),a("design:type",String)],tt.prototype,"id",void 0);n([p(),dt(),pt({name:"access_token"}),a("design:type",String)],tt.prototype,"accessToken",void 0);n([p(),c(),a("design:type",String)],tt.prototype,"name",void 0);n([p(),K(),a("design:type",String)],tt.prototype,"email",void 0);n([$(),c(),a("design:type",Object)],tt.prototype,"alias",void 0);var $t=class{scope;acl};n([$(),c(),a("design:type",String)],$t.prototype,"scope",void 0);n([p(),g(),c({each:!0}),a("design:type",Array)],$t.prototype,"acl",void 0);var Z=class{id;accessToken;name;scopes;expiresIn};n([p(),x(),a("design:type",String)],Z.prototype,"id",void 0);n([p(),dt(),a("design:type",String)],Z.prototype,"accessToken",void 0);n([p(),c(),a("design:type",String)],Z.prototype,"name",void 0);n([p(),Tt(),m(),y(()=>$t),a("design:type",Object)],Z.prototype,"scopes",void 0);n([p(),Ti(),a("design:type",Number)],Z.prototype,"expiresIn",void 0);var lt=class extends Z{email;alias;emailChange;groups;constructor(e){super(),e!=null&&(this.id=e.id,this.name=e.name,this.accessToken=e.accessToken,this.scopes=e.scopes,this.email=e.email,this.emailChange=e.emailChange,this.alias=e.alias,this.groups=e.groups)}};n([p(),K(),a("design:type",String)],lt.prototype,"email",void 0);n([$(),c(),a("design:type",Object)],lt.prototype,"alias",void 0);n([$(),c(),a("design:type",Object)],lt.prototype,"emailChange",void 0);n([p(),g(),c({each:!0}),a("design:type",Array)],lt.prototype,"groups",void 0);var He=function(t){return t.TYPE_USER="user",t.TYPE_APPLICATION="application",t.TYPE_GROUP="group",t.TYPE_ACL="acl",t}(He||{});var B=class{id;label;type;assigned};n([p(),x(),a("design:type",String)],B.prototype,"id",void 0);n([p(),c(),a("design:type",String)],B.prototype,"label",void 0);n([p(),Ni(He),a("design:type",String)],B.prototype,"type",void 0);n([p(),W(),a("design:type",Boolean)],B.prototype,"assigned",void 0);var ut=class{id;name;domain;source};n([p(),x(),a("design:type",String)],ut.prototype,"id",void 0);n([p(),c(),a("design:type",String)],ut.prototype,"name",void 0);n([p(),c(),a("design:type",String)],ut.prototype,"domain",void 0);n([p(),g(),m({each:!0}),y(()=>B),a("design:type",Array)],ut.prototype,"source",void 0);var It=class{id;name;source};n([p(),x(),a("design:type",String)],It.prototype,"id",void 0);n([p(),c(),a("design:type",String)],It.prototype,"name",void 0);n([p(),g(),m({each:!0}),y(()=>B),a("design:type",Array)],It.prototype,"source",void 0);var wt=class{id;name;source};n([p(),x(),a("design:type",String)],wt.prototype,"id",void 0);n([p(),c(),a("design:type",String)],wt.prototype,"name",void 0);n([p(),g(),m({each:!0}),y(()=>B),a("design:type",Array)],wt.prototype,"source",void 0);var ft=class{id;domain;name;users=[];groups=[];applications=[]};n([p(),x(),a("design:type",String)],ft.prototype,"id",void 0);n([p(),c(),a("design:type",String)],ft.prototype,"domain",void 0);n([p(),c(),a("design:type",String)],ft.prototype,"name",void 0);n([p(),g(),m({each:!0}),y(()=>It),a("design:type",Array)],ft.prototype,"users",void 0);n([p(),g(),m({each:!0}),y(()=>ut),a("design:type",Array)],ft.prototype,"groups",void 0);n([p(),g(),m({each:!0}),y(()=>wt),a("design:type",Array)],ft.prototype,"applications",void 0);var St=class{id;name;username};n([p(),c(),a("design:type",String)],St.prototype,"id",void 0);n([p(),c(),a("design:type",String)],St.prototype,"name",void 0);n([p(),c(),a("design:type",String)],St.prototype,"username",void 0);var Dt=class{id;name;publicKeyBase64;ttl};n([p(),x(),a("design:type",String)],Dt.prototype,"id",void 0);n([p(),c(),a("design:type",String)],Dt.prototype,"name",void 0);n([p(),di(),pt({name:"public_key_base64"}),a("design:type",String)],Dt.prototype,"publicKeyBase64",void 0);n([p(),ue(),a("design:type",Number)],Dt.prototype,"ttl",void 0);var et=class{id;domain;name;assigned;inherited};n([p(),x(),a("design:type",String)],et.prototype,"id",void 0);n([p(),c(),a("design:type",String)],et.prototype,"domain",void 0);n([p(),c(),a("design:type",String)],et.prototype,"name",void 0);n([p(),W(),a("design:type",Boolean)],et.prototype,"assigned",void 0);n([p(),W(),a("design:type",Boolean)],et.prototype,"inherited",void 0);var C=class{id;scope;name;acl};n([p(),x(),a("design:type",String)],C.prototype,"id",void 0);n([$(),c(),a("design:type",String)],C.prototype,"scope",void 0);n([$(),c(),a("design:type",String)],C.prototype,"name",void 0);n([p(),g(),m({each:!0}),y(()=>et),a("design:type",Array)],C.prototype,"acl",void 0);var ge=class extends St{password;scopes};n([$(),c(),a("design:type",String)],ge.prototype,"password",void 0);n([p(),g(),m({each:!0}),y(()=>C),a("design:type",Array)],ge.prototype,"scopes",void 0);var it=class{id;name;domain;children=[]};n([p(),x(),a("design:type",String)],it.prototype,"id",void 0);n([p(),c(),a("design:type",String)],it.prototype,"name",void 0);n([p(),c(),a("design:type",String)],it.prototype,"domain",void 0);n([p(),g(),m({each:!0}),y(()=>it),a("design:type",Array)],it.prototype,"children",void 0);var H=class{static PASSWORD_VALIDATOR=/^(?=.{8,})(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!"#$%&\'()*+,-.\/:;<=>?@[\]^_`{}~]).*$/;id;email;name;enabled;alias};n([p(),x(),a("design:type",String)],H.prototype,"id",void 0);n([p(),K(),a("design:type",String)],H.prototype,"email",void 0);n([p(),c(),a("design:type",String)],H.prototype,"name",void 0);n([p(),W(),a("design:type",Boolean)],H.prototype,"enabled",void 0);n([$(),c(),a("design:type",Object)],H.prototype,"alias",void 0);var ye=class extends it{users=[];scopes=[]};n([p(),g(),m({each:!0}),y(()=>H),a("design:type",Array)],ye.prototype,"users",void 0);n([p(),g(),m({each:!0}),y(()=>C),a("design:type",Array)],ye.prototype,"scopes",void 0);var rt=class{id;name;domain;children};n([p(),c(),a("design:type",String)],rt.prototype,"id",void 0);n([p(),c(),a("design:type",String)],rt.prototype,"name",void 0);n([p(),c(),a("design:type",String)],rt.prototype,"domain",void 0);n([p(),g(),m({each:!0}),y(()=>rt),a("design:type",Array)],rt.prototype,"children",void 0);var Xt=class{id;name;acl};n([p(),x(),a("design:type",String)],Xt.prototype,"id",void 0);n([p(),c(),a("design:type",String)],Xt.prototype,"name",void 0);n([p(),g(),m({each:!0}),y(()=>rt),a("design:type",Array)],Xt.prototype,"acl",void 0);var ot=class{id;domain;name;assigned;inherited};n([p(),x(),a("design:type",String)],ot.prototype,"id",void 0);n([p(),c(),a("design:type",String)],ot.prototype,"domain",void 0);n([p(),c(),a("design:type",String)],ot.prototype,"name",void 0);n([p(),W(),a("design:type",Boolean)],ot.prototype,"assigned",void 0);n([p(),W(),a("design:type",Boolean)],ot.prototype,"inherited",void 0);var he=class extends H{groups;scopes};n([p(),g(),m({each:!0}),y(()=>ot),a("design:type",Array)],he.prototype,"groups",void 0);n([p(),g(),m({each:!0}),y(()=>C),a("design:type",Array)],he.prototype,"scopes",void 0);var ve=class{token;expires_in};n([p(),dt(),a("design:type",String)],ve.prototype,"token",void 0);n([p(),ue(),a("design:type",Number)],ve.prototype,"expires_in",void 0);var te=class{data};n([p(),a("design:type",Object)],te.prototype,"data",void 0);var Je=class{data};n([p(),a("design:type",Array)],Je.prototype,"data",void 0);var ee=new ti("HeimdallHttpClient");function Di(t,e){return new Et(new We(t,e))}var We=class extends ae{httpHandler;envService;constructor(e,i){super(),this.httpHandler=e,this.envService=i}handle(e){let i=e.clone({url:`${this.envService.get("apiHeimdallUrl")}${e.url}`,setHeaders:{"Client-ID":this.envService.get("apiHeimdallClientId")}});return this.httpHandler.handle(i)}};var xe=(()=>{class t extends me{httpClient;constructor(i){super(),this.httpClient=i}login$(i,r,o){return this.wrapObjectRequest(this.httpClient.post("/user/login",{email:i,password:r,scopes:o}),Qt)}loginManagement$(i,r){return this.wrapObjectRequest(this.httpClient.post("/management/login",{email:i,password:r}),te).pipe(A(o=>this.adapt(o.data,tt)))}identity$(i){return this.wrapObjectRequest(this.httpClient.get("/user/identity",{headers:{Authorization:"Bearer "+i}}),Qt)}static \u0275fac=function(r){return new(r||t)(M(ee))};static \u0275prov=F({token:t,factory:t.\u0275fac})}return t})();var _t=class extends Error{};_t.prototype.name="InvalidTokenError";function yo(t){return decodeURIComponent(atob(t).replace(/(.)/g,(e,i)=>{let r=i.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function ho(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return yo(e)}catch{return atob(e)}}function mt(t,e){if(typeof t!="string")throw new _t("Invalid token specified: must be a string");e||(e={});let i=e.header===!0?0:1,r=t.split(".")[i];if(typeof r!="string")throw new _t(`Invalid token specified: missing part #${i+1}`);let o;try{o=ho(r)}catch(s){throw new _t(`Invalid token specified: invalid base64 for part #${i+1} (${s.message})`)}try{return JSON.parse(o)}catch(s){throw new _t(`Invalid token specified: invalid json for part #${i+1} (${s.message})`)}}var gt=(()=>{class t{identityBridge;constructor(i){this.identityBridge=i}createIdentity(i){let r=mt(i.accessToken);if(r==null)throw new P("Authentication token could not be decoded");this.verifyToken(r);let o=new lt(i);return r.exp!=null&&r.iat!=null?o.expiresIn=r.exp-r.iat:o.expiresIn=0,o}loginUser$(i,r,o){return this.identityBridge.login$(i,r,o).pipe(A(s=>this.createIdentity(s)))}loginManagement$(i,r){return this.identityBridge.loginManagement$(i,r).pipe(Xe(o=>{let s=mt(o.accessToken);if(s==null)throw new P("Authentication token could not be decoded");if(s.exp!=null&&Date.now()>=s.exp*1e3)throw new k("JWT token expired")}))}identityUser$(i){return this.identityBridge.identity$(i).pipe(A(r=>this.createIdentity(r)))}verifyToken(i){if(i.exp!=null&&Date.now()>=i.exp*1e3)throw new k("JWT token expired")}static \u0275fac=function(r){return new(r||t)(M(xe))};static \u0275prov=F({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Vi=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=oe({type:t});static \u0275inj=re({providers:[{provide:ee,useFactory:Di,deps:[ae,st]},{provide:Et,useExisting:ee},xe,gt],imports:[ne,ei]})}return t})();var Ie=(()=>{class t{envService;identityFacade;constructor(i,r){this.envService=i,this.identityFacade=r}authenticate$(i,r){return this.identityFacade.loginUser$(i,r,this.envService.get("apiHeimdallScopes")).pipe(L(o=>{throw o instanceof at?o.status==U.Unauthorized?new I(o.message,{cause:o}):o.status==U.Forbidden?new q(o.message,{cause:o}):new I(o.message,{cause:o}):o instanceof P?new I(o.message,{cause:o}):o instanceof k?new I("Error when verifying user identity",{cause:o}):new I("Unexpected error occurred while authenticating through authorization authority",{cause:o})}),A(o=>new N(o.id,o.accessToken,o)))}static \u0275fac=function(r){return new(r||t)(M(st),M(gt))};static \u0275prov=F({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var V=(()=>{class t{envService;authenticator=null;storage=null;identity=null;_identity$=new ie(null);originalIdentity=null;_originalIdentity$=new ie(null);identityExpirationDate;originalIdentityExpirationDate;_permissions$=new ie([]);permissions$=this._permissions$.asObservable();constructor(i){this.envService=i}login(i,r){return T(this,null,function*(){if(this.identity=null,this.identityExpirationDate=void 0,this._identity$.next(null),yield this.storage?.remove("identity"),typeof i=="string"){let o=this.getAuthenticator();this.identity=yield Se(o.authenticate$(i,r));let s=this.identity.getToken();if(!s)throw new bt("Authenticator returned identity without a token.");let d=mt(s);this.identityExpirationDate=d.exp?d.exp*1e3:Date.now()+60*60*1e3,this._identity$.next(this.identity)}else{this.identity=i;let o=this.identity.getToken();if(!o)throw new bt("Provided identity does not contain a token.");let s=mt(o);this.identityExpirationDate=s.exp?s.exp*1e3:Date.now()+60*60*1e3,this._identity$.next(i)}this.storage!=null&&(yield this.storage.set("identity",JSON.stringify(this.identity)))})}loginAs(i){return T(this,null,function*(){if(this.originalIdentity=this.identity,this.originalIdentityExpirationDate=this.identityExpirationDate,this._originalIdentity$.next(this._identity$.getValue()),typeof i=="string"){let r=this.getAuthenticator();this.identity=yield Se(r.authenticate$(i));let o=this.identity.getToken();if(!o)throw new bt("Authenticator returned identity without a token.");let s=mt(o);this.identityExpirationDate=s.exp?s.exp*1e3:Date.now()+60*60*1e3,this._identity$.next(this.identity)}else{this.identity=i;let r=this.identity.getToken();if(!r)throw new bt("Provided identity does not contain a token.");let o=mt(r);this.identityExpirationDate=o.exp?o.exp*1e3:Date.now()+60*60*1e3,this._identity$.next(i)}this.storage!=null&&(this.storage.set("originalIdentity",JSON.stringify(this.originalIdentity)),this.storage.set("identity",JSON.stringify(this.identity)))})}logout(){return T(this,null,function*(){this.originalIdentity?(yield this.login(this.originalIdentity),this.originalIdentity=null,this.originalIdentityExpirationDate=void 0,this._originalIdentity$.next(null),this.storage?.remove("originalIdentity")):(this.identity=null,this.identityExpirationDate=void 0,this._identity$.next(null),this.storage?.remove("identity")),this.setPermissions([])})}isLoggedIn(){return this.identity!=null&&this.identityExpirationDate!=null&&this.identityExpirationDate>=Date.now()}isLoggedIn$(){return this.getIdentity$().pipe(A(i=>i!=null&&this.identityExpirationDate!=null&&this.identityExpirationDate>=Date.now()))}isLoggedInAsAnotherUser(){return this.originalIdentity!=null&&this.originalIdentityExpirationDate!=null&&this.originalIdentityExpirationDate>=Date.now()}isLoggedInAsAnotherUser$(){return this.getOriginalIdentity$().pipe(A(i=>i!=null&&this.originalIdentityExpirationDate!=null&&this.originalIdentityExpirationDate>=Date.now()))}getIdentity(){return this.identity}getIdentity$(){return this._identity$.asObservable()}getOriginalIdentity$(){return this._originalIdentity$.asObservable()}getAuthenticator(){if(this.authenticator==null)throw new bt("Authenticator has not been set.");return this.authenticator}setAuthenticator(i){this.authenticator=i}getStorage(){return this.storage}setStorage(i){this.storage=i}setPermissions(i){this._permissions$.next(i)}hasPermission(i){return this.envService.get("production")===!1?!0:this._permissions$.getValue().find(r=>r===i)!=null}hasPermission$(i){return this.permissions$.pipe(A(r=>this.envService.get("production")===!1?!0:r.find(o=>o===i)!=null))}static \u0275fac=function(r){return new(r||t)(M(st))};static \u0275prov=F({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Ye=(()=>{class t{identityFacade;constructor(i){this.identityFacade=i}authenticate$(i){return this.identityFacade.identityUser$(i).pipe(L(r=>{throw r instanceof at?r.status==U.Unauthorized?new I(r.message,{cause:r}):r.status==U.Forbidden?new q(r.message,{cause:r}):new I(r.message,{cause:r}):r instanceof P?new I(r.message,{cause:r}):r instanceof k?new I("Error when verifying user identity",{cause:r}):new I("Unexpected error occurred while authenticating through authorization authority",{cause:r})}),A(r=>new N(r.id,r.accessToken,r)))}static \u0275fac=function(r){return new(r||t)(M(gt))};static \u0275prov=F({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Ge=(()=>{class t{identityFacade;constructor(i){this.identityFacade=i}authenticate$(i,r){return this.identityFacade.loginManagement$(i,r).pipe(L(o=>{throw o instanceof at?o.status==U.Unauthorized?new I(o.message,{cause:o}):o.status==U.Forbidden?new q(o.message,{cause:o}):new I(o.message,{cause:o}):o instanceof P?new I(o.message,{cause:o}):o instanceof k?new I("Error when verifying user identity",{cause:o}):new I("Unexpected error occurred while authenticating through authorization authority",{cause:o})}),A(o=>new N(o.id,o.accessToken,o)))}static \u0275fac=function(r){return new(r||t)(M(gt))};static \u0275prov=F({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Ui=(()=>{class t{http=At(Et);envService=At(st);authenticate$(i,r){return this.http.post(`${this.envService.get("apiLaraBaseUrl")}/authenticate`,{username:i,password:r}).pipe(L(o=>{throw o instanceof at?o.status==U.Unauthorized?new I(o.message,{cause:o}):o.status==U.Forbidden?new q(o.message,{cause:o}):new I(o.message,{cause:o}):o instanceof P?new I(o.message,{cause:o}):o instanceof k?new I("Error when verifying user identity",{cause:o}):new I("Unexpected error occurred while authenticating through authorization authority",{cause:o})}),A(o=>new N(i,o.token,o)))}static \u0275fac=function(r){return new(r||t)};static \u0275prov=F({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Pi=(()=>{class t{user=At(V);mojeAuthenticator=At(Ui);signIn(i,r){return T(this,null,function*(){this.user.setStorage(new vt),this.user.setAuthenticator(this.mojeAuthenticator),yield this.user.login(i,r)})}restore(){return T(this,null,function*(){let i=new vt;this.user.setStorage(i);let r=yield i.get("originalIdentity");if(r){let o=yield i.get("identity"),s=yield JSON.parse(r),d=Ot(N,s);if(yield this.user.login(d),o){let l=yield JSON.parse(o),_=Ot(N,l);yield this.user.loginAs(_)}}else{let o=yield i.get("identity");if(o){let s=yield JSON.parse(o),d=Ot(N,s);yield this.user.login(d)}}})}static \u0275fac=function(r){return new(r||t)};static \u0275prov=F({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var yl=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=oe({type:t});static \u0275inj=re({providers:[V,Ie,Ye,Ge,Pi],imports:[ne,Vi]})}return t})();var Al=(()=>{class t{user;router;pageRegistry;linkPipe;constructor(i,r,o,s){this.user=i,this.router=r,this.pageRegistry=o,this.linkPipe=s}canActivate(i,r){if(!this.user.isLoggedIn()){this.user.logout();let o=this.pageRegistry.get(i.data.unauthenticatedPageKey),s=this.linkPipe.transform(o);return this.router.navigate([s])}return!0}static \u0275fac=function(r){return new(r||t)(M(V),M(ri),M(_e),M(Ae))};static \u0275prov=F({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var So=ii("SecureStoragePlugin",{web:()=>import("./chunk-VLXMZK5V.js").then(t=>new t.SecureStoragePluginWeb)});var Ao=function(t){return t.sign="sign",t.validate="validate",t}(Ao||{}),ht=function(t){return t.signIn="account.app-moje.page.sign.in",t.signReset="account.app-moje.page.sign.reset",t.validateEmail="account.app-moje.page.validate.email",t.validatePassword="account.app-moje.page.validate.password",t.dashboardRoot="customer.app-moje.page.dashboard.root",t.contractRoot="customer.app-moje.page.contract.root",t.deviceRoot="customer.app-moje.page.device.root",t}(ht||{}),qu={signIn:{key:ht.signIn,relativePath:"in"},signReset:{key:ht.signReset,relativePath:"reset"},validateEmail:{key:ht.validateEmail,relativePath:"email"},validatePassword:{key:ht.validatePassword,relativePath:"password"},dashboardRoot:{key:ht.dashboardRoot,relativePath:"dashboard"},contractRoot:{key:ht.contractRoot,relativePath:"contract"},deviceRoot:{key:ht.deviceRoot,relativePath:"device"}};var ki=function(t){return t.dashboard="app-moje.module.dashboard",t}(ki||{}),Hu={dashboard:{key:ki.dashboard}};export{I as a,$ as b,wn as c,m as d,p as e,Nn as f,K as g,Rn as h,x as i,W as j,Zn as k,Ti as l,c as m,g as n,Tt as o,fe as p,V as q,vt as r,Pi as s,yl as t,Al as u,Ao as v,ht as w,qu as x};
